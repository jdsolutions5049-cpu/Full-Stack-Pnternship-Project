<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JD Mart | Order History</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/style.css">
</head>

<a href="/products" class="jd-back mb-0 m-3">← Back to Products</a>

<div class="jd-view-container">

  <!-- LEFT IMAGE PANEL -->
  <div class="jd-view-image" style="background-image:url('<%= product.images %>')">

    <span class="jd-view-market">
      <i class="fa-solid fa-arrow-trend-down"></i>
      <%= product.belowMarketPercent %>% below market
    </span>

    <span class="jd-view-grade">
      <i class="fa-regular fa-star"></i> Grade <%= product.grade %>
    </span>
  </div>


  <!-- RIGHT CONTENT -->
  <div class="jd-view-content">

    

    <h1 class="jd-title"><%= product.name %></h1>

    <!-- PRICE CARD -->
    <div class="jd-price-card">
      <div class="jd-price-main">
        ₹<%= product.pricePerQuintal.toLocaleString("en-IN") %>
        <span>per quintal</span>
      </div>

      <div class="jd-market-row">
        Market Price:
        <span class="jd-old">
          ₹<%= product.oldPrice.toLocaleString("en-IN") %>
        </span>

        <span class="jd-save">
          Save ₹<%= (product.oldPrice - product.pricePerQuintal).toLocaleString("en-IN") %>
        </span>
      </div>
    </div>

    <!-- DESCRIPTION -->
    <div class="jd-section">
      <h3>Description</h3>
      <p><%= product.description %></p>
    </div>

    <!-- INFO CARDS -->
    <div class="jd-info-grid">
      <div class="jd-info-card">
        <i class="fa-solid fa-box"></i>
        <div>
          <small>Available Quantity</small>
          <strong><%= product.available %> quintals</strong>
        </div>
      </div>

      <div class="jd-info-card">
        <i class="fa-regular fa-clock"></i>
        <div>
          <small>Delivery Time</small>
          <strong>
            <%= product.deliveryTime.minDays %>-<%= product.deliveryTime.maxDays %> days
          </strong>
        </div>
      </div>
    </div>

    <!-- QUANTITY -->
    <div class="jd-quantity-card">
      <label>Quantity (quintals)</label>

      <div class="jd-stepper">
        <button class="jd-step">−</button>
        <input type="text" value="1" />
        <button class="jd-step">+</button>
      </div>

      <div class="jd-total">
        <span>Total Price</span>
        <strong>
          ₹<%= product.pricePerQuintal.toLocaleString("en-IN") %>
        </strong>
      </div>

      <div class="jd-actions">
        <a href="/add-to-cart" class="jd-btn-outline">
          <i class="fa-solid fa-cart-shopping"></i>
          Add to Cart
        </a>

        <form action="/orders/buy-now/<%= product._id %>" method="POST">
  <input type="hidden" name="quantity" id="buyQty" value="1">
  <button class="jd-btn-solid" type="submit">
    Buy Now
  </button>
</form>

      </div>
    </div>

  </div>
</div>

<!-- FOOTER -->
<footer class="jd-footer-section mt-5">
  <div class="container-fluid px-5 mt-3">
    <div class="row gy-4">

      <!-- BRAND -->
      <div class="col-lg-4 col-md-6">
        <div class="d-flex align-items-center mb-3">
          <img src="/images/image.png" height="40" style="border-radius:8px;">
          <h5 class="ms-2 mb-0">JD Mart</h5>
        </div>
        <p class="text-muted">
          JD Mart connects farmers directly with buyers, offering fresh crops, transparent pricing, and fast delivery across regions.
        </p>
      </div>

      <!-- QUICK LINKS -->
      <div class="col-lg-2 col-md-6">
        <h6 class="footer-title">Quick Links</h6>
        <ul class="footer-links">
          <li><a href="/">Home</a></li>
          <li><a href="/profile">My Profile</a></li>
          <li><a href="/orders">My Orders</a></li>
          <li><a href="/listings">Browse Products</a></li>
        </ul>
      </div>

      <!-- SUPPORT -->
      <div class="col-lg-3 col-md-6">
        <h6 class="footer-title">Support</h6>
        <ul class="footer-links">
          <li><a href="#">Help Center</a></li>
          <li><a href="#">Delivery Info</a></li>
          <li><a href="#">Returns & Refunds</a></li>
          <li><a href="#">Privacy Policy</a></li>
        </ul>
      </div>

      <!-- CONTACT -->
      <div class="col-lg-3 col-md-6">
        <h6 class="footer-title">Contact Us</h6>
        <p class="mb-1"><i class="fa-solid fa-location-dot"></i> India</p>
        <p class="mb-1"><i class="fa-solid fa-envelope"></i> support@jdmart.com</p>
        <p><i class="fa-solid fa-phone"></i> +91 98765 43210</p>

        <div class="footer-social mt-3">
          <a href="#"><i class="fa-brands fa-facebook-f"></i></a>
          <a href="#"><i class="fa-brands fa-instagram"></i></a>
          <a href="#"><i class="fa-brands fa-x-twitter"></i></a>
          <a href="#"><i class="fa-brands fa-linkedin-in"></i></a>
        </div>
      </div>

    </div>

    <hr class="mt-4">

    <div class="text-center pb-3">
      <small>
        © <%= new Date().getFullYear() %> JD Mart. All rights reserved.
      </small>
    </div>
  </div>
</footer>


<script>
  const qtyInput = document.querySelector(".jd-stepper input");
  const hiddenQty = document.getElementById("buyQty");
  const totalPrice = document.querySelector(".jd-total strong");

  const price = <%= product.pricePerQuintal %>;
  const maxQty = <%= product.available %>;

  function updateTotal(val) {
    val = Math.max(1, Math.min(maxQty, val));
    qtyInput.value = val;
    hiddenQty.value = val;
    totalPrice.textContent = "₹" + (val * price).toLocaleString("en-IN");
  }

  // Prevent typing invalid values
  qtyInput.addEventListener("input", () => {
    updateTotal(parseInt(qtyInput.value) || 1);
  });

  document.querySelectorAll(".jd-step").forEach(btn => {
    btn.addEventListener("click", e => {
      e.preventDefault();
      let val = parseInt(qtyInput.value) || 1;

      if (btn.textContent === "+") val++;
      if (btn.textContent === "−") val--;

      updateTotal(val);
    });
  });

  // Safety: update before submit
  document.querySelector("form").addEventListener("submit", () => {
    hiddenQty.value = qtyInput.value;
  });
</script>



</body>
</html>
